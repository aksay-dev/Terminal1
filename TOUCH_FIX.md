# –ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞—á—Å–∫—Ä–∏–Ω–∞

## üîç –¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞

```
W (xxx) GT911: Invalid coords: x=59136, y=44544
```

–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∏–µ (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å < 480).

## ‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. –ß—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ü–µ–ª–∏–∫–æ–º
–¢–µ–ø–µ—Ä—å —á–∏—Ç–∞–µ–º —Å—Ç–∞—Ç—É—Å + –¥–∞–Ω–Ω—ã–µ —Ç–æ—á–∫–∏ –≤–º–µ—Å—Ç–µ (9 –±–∞–π—Ç–æ–≤):
```c
gt911_read_reg(GT911_REG_STATUS, touch_data, 9);
```

### 2. –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ—Ç–ª–∞–¥–∫–∞
–ö–∞–∂–¥—ã–µ 50 –∫–∞—Å–∞–Ω–∏–π –≤—ã–≤–æ–¥–∏–º —Å—ã—Ä—ã–µ –±–∞–π—Ç—ã:
```
I (xxx) GT911: Raw: [8X XX XX XX XX] -> x=XXX, y=XXX
```

### 3. –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
–ü—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º:
- Config Version
- Resolution (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 480x480)
- Max Touch Points
- Module Switch (X/Y swap)

## üöÄ –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ

```bash
idf.py build flash monitor
```

## üìä –ß—Ç–æ —Å–º–æ—Ç—Ä–µ—Ç—å –≤ –ª–æ–≥–∞—Ö

### 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
```
I (xxx) GT911: ‚úì GT911 detected at I2C addr 0x5D
I (xxx) GT911: ‚úì Product ID: 9911
I (xxx) GT911: ‚úì Config Ver: 0xXX
I (xxx) GT911: ‚úì Resolution: 480 x 480      ‚Üê –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 480x480!
I (xxx) GT911: ‚úì Max Touch Points: 5
I (xxx) GT911: ‚úì Module Switch 1: 0xXX (X/Y normal, INT falling)
```

### 2. –ü—Ä–∏ –∫–∞—Å–∞–Ω–∏–∏
```
I (xxx) GT911: Raw: [81 B4 00 7A 00] -> x=180, y=122
```

–†–∞–∑–±–æ—Ä:
- `81` = —Å—Ç–∞—Ç—É—Å (bit 7=1 –≥–æ—Ç–æ–≤–æ, bit 0=1 —Ç–æ—á–∫–∞)
- `B4 00` = X –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ (0x00B4 = 180)
- `7A 00` = Y –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ (0x007A = 122)

## ‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 1: Resolution != 480x480

–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ —á—Ç–æ-—Ç–æ —Ç–∏–ø–∞:
```
I (xxx) GT911: ‚úì Resolution: 1024 x 600
```

**–†–µ—à–µ–Ω–∏–µ:** GT911 –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –¥—Ä—É–≥–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ. –ù—É–∂–Ω–æ –ª–∏–±–æ:
1. –ò–∑–º–µ–Ω–∏—Ç—å `TOUCH_MAX_X/Y` –≤ `touch.h`
2. –ò–ª–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:

```c
touch_last_x = (x_raw * 480) / max_x_from_config;
touch_last_y = (y_raw * 480) / max_y_from_config;
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: X/Y swapped

–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ:
```
Module Switch 1: 0xXX (X/Y swapped, ...)
```

**–†–µ—à–µ–Ω–∏–µ:** –ü–æ–º–µ–Ω—è—Ç—å –º–µ—Å—Ç–∞–º–∏ –≤ `touch_touched()`:
```c
touch_last_x = y_raw;  // Swap!
touch_last_y = x_raw;
```

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤—Å–µ –µ—â–µ > 4096

–ï—Å–ª–∏ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤—Å–µ —Ä–∞–≤–Ω–æ –æ–≥—Ä–æ–º–Ω—ã–µ, –¥–æ–±–∞–≤—å—Ç–µ –≤ –Ω–∞—á–∞–ª–æ `touch_touched()`:

```c
/* TEMP DEBUG: Log all raw data */
ESP_LOGI(TAG, "Status byte: 0x%02X", status);
ESP_LOG_BUFFER_HEX(TAG, touch_data, 9);
```

–ò –ø—Ä–∏—à–ª–∏—Ç–µ –≤—ã–≤–æ–¥.

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø—Ä—ã–≥–∞—é—Ç

–î–æ–±–∞–≤—å—Ç–µ —Ñ–∏–ª—å—Ç—Ä:
```c
static int16_t prev_x = 0, prev_y = 0;
int16_t diff_x = abs(x_raw - prev_x);
int16_t diff_y = abs(y_raw - prev_y);

if (diff_x > 50 || diff_y > 50) {
    // –ë–æ–ª—å—à–æ–π —Å–∫–∞—á–æ–∫ - –≤–æ–∑–º–æ–∂–Ω–æ –æ—à–∏–±–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    ESP_LOGW(TAG, "Jump detected: dx=%d, dy=%d", diff_x, diff_y);
    return false;
}

prev_x = x_raw;
prev_y = y_raw;
```

## üéØ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

```
I (xxx) GT911: GT911 initialization complete!
I (xxx) HELLO_WORLD: Touchscreen input device registered

# –ü—Ä–∏ –∫–∞—Å–∞–Ω–∏–∏ (—Ä–∞–∑ –≤ 50 —Ä–∞–∑):
I (xxx) GT911: Raw: [81 XX XX XX XX] -> x=180, y=122

# –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏:
I (xxx) HELLO_WORLD: Button clicked! Total clicks: 1
```

**–ë–ï–ó** warning'–æ–≤ –ø—Ä–æ Invalid coords!

## üìã –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –æ—Ç–ª–∞–¥–∫–∏

- [ ] GT911 –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ
- [ ] Resolution = 480 x 480 (–∏–ª–∏ –¥—Ä—É–≥–æ–µ –∏–∑–≤–µ—Å—Ç–Ω–æ–µ)
- [ ] –ü—Ä–∏ –∫–∞—Å–∞–Ω–∏–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è –ª–æ–≥–∏ Raw
- [ ] –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ –ª–æ–≥–∞—Ö –≤—ã–≥–ª—è–¥—è—Ç —Ä–∞–∑—É–º–Ω–æ (0-480)
- [ ] –ù–ï–¢ warning'–æ–≤ –ø—Ä–æ Invalid coords
- [ ] –ö–Ω–æ–ø–∫–∞ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –Ω–∞–∂–∞—Ç–∏–µ

## üîß –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥: –ü—Ä—è–º–æ–µ —á—Ç–µ–Ω–∏–µ

–ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç:

```c
bool touch_touched_simple(void)
{
    uint8_t buf[40];  // Read all touch data
    if (gt911_read_reg(0x814E, buf, 40) != ESP_OK) {
        return false;
    }
    
    uint8_t status = buf[0];
    if ((status & 0x80) == 0) return false;
    
    uint8_t points = status & 0x0F;
    if (points == 0) return false;
    
    // Clear status
    uint8_t zero = 0;
    gt911_write_reg(0x814E, &zero, 1);
    
    // Log ALL bytes for debugging
    ESP_LOG_BUFFER_HEX(TAG, buf, 40);
    
    // Parse first point (starts at buf[1])
    uint16_t x = buf[1] | (buf[2] << 8);
    uint16_t y = buf[3] | (buf[4] << 8);
    
    ESP_LOGI(TAG, "Simple read: x=%d, y=%d", x, y);
    
    // Update globals
    touch_last_x = x;
    touch_last_y = y;
    
    return true;
}
```

–ó–∞–º–µ–Ω–∏—Ç–µ –≤—ã–∑–æ–≤ `touch_touched()` –Ω–∞ `touch_touched_simple()` –≤—Ä–µ–º–µ–Ω–Ω–æ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏.

---

**–°–æ–±–µ—Ä–∏—Ç–µ, –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∏ –ø—Ä–∏—à–ª–∏—Ç–µ –ª–æ–≥–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ + –ø–µ—Ä–≤–æ–≥–æ –∫–∞—Å–∞–Ω–∏—è!**

